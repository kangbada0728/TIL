---
tags:
  - 학습정리
  - SLiPP_25차_스터디
  - 시스템_설계
  - 책_가상_면접_사례로_배우는_대규모_시스템_설계_기초
  - 책_System_Design_Interview
---
이 책에서 반복되는 내용이다. 하지만 중요하니까 한번 더 적는다.

>[!important]
>시스템 설계 면접 문제는 의도적으로 어떤 정해진 결말을 갖지 않도록 만들어진다.
>따라서 면접장에서 시스템을 성공적으로 설계해 내려면 질문을 통해 모호함을 줄이고 요구사항을 알아내야 한다.

- 시스템의 기본 기능
	1. URL 단축 : 주어진 긴 URL 을 훨씬 짧게 줄인다.
	2. URL 리디렉션 : 축약된 URL 로 HTTP 요청이 오면 원래 URL 로 안내
	3. 높은 가용성과 규모 확장성, 그리고 장애 감내가 요구됨

## URL 리디렉션의 종류

단축 URL 을 사용하기 때문에 URL 리디렉션은 필수적이다.
여기에는 301 응답과 302 응답 방법이 있는데, 두개의 차이는 캐시의 차이이다.

- 301 Permanently Moved
	- 이 응답은 해당 URL 에 대한 HTTP 요청의 처리 책임이 영구적으로 Location 헤더에 반환된 URL 로 이전되었다는 응답이다.
	- 영구적으로 이전되었으므로, 브라우저는 이 응답을 캐시한다.
	- 따라서 추후 같은 단축 URL 에 요청을 보낼 필요가 있을 때 브라우저는 캐시된 원래 URL 로 요청을 보내게 된다.
- 302 Found
	- 이 응답은 주어진 URL 로의 요청이 일시적으로 Location 헤더가 지정하는 URL 에 의해 처리되어야 한다는 응답이다.
	- 따라서 클라이언트의 요청은 언제나 단축 URL 서버에 먼저 보내진 후에 원래 URL 로 리디렉션되어야 한다.

- 301 응답의 장점
	- 서버 부하를 줄이는데 도움이 된다.
		- 첫 번째 요청만 단축 URL 서버로 전송되고, 이후에는 캐시된 내용을 사용할 것이기 때문이다.
- 302 응답의 장점
	- 트래픽 분석할 때 클릭 발생율, 발생 위치를 추적하는데 더 유리하다.

## 단축 URL 저장 위치

- 해시 테이블이 가장 직관적인 방법이지만 메모리는 비싼 자원이기 때문에 적절하지 않다.
- 따라서 RDBMS 에 <단축 URL, 원래 URL> 을 RDBMS 에 저장하는 방법이 더 나은 방법이다.

## 해시 함수

- 원래 URL 을 단축 URL 로 바꾸는데 필수적이다.
- 해시 함수 구현으로 두가지 방법을 살펴보자.
	1. 해시 후 충돌 해소
	2. base-62 변환

### 해시 후 충돌 해소

- 먼저 잘 알려진 해시 함수(CRC32, MD5, SHA-1)과 같은 해시 함수들을 이용하여 원래 URL 을 줄인다.
- 그런데 가장 짧은 해시값도 요구사항인 길이 7 보다는 길다. 따라서 잘라야한다.
- 그런데 자르면 해시값이 충돌날 수 있다. 따라서 충돌이 해소될 때까지 사전에 정한 문자열을 해시값에 덧붙이고, 다시 해시함수를 이용하여 해싱을 하는 과정을 반복한다. 언제까지? 충돌이 나지 않을때까지.
- 이 방법을 쓰면 충돌은 해소할 수 있지만 단축 URL 을 생성할 때 한 번 이상 데이터베이스 질의를 해야해서 오버헤드가 크다.
- 여기서 데이터베이스 대신 블룸 필터를 사용하면 성능을 높일 수 있다.
	- 블룸 필터란?
		- 어떤 집합에 특정 원소가 있는지 검사할 수 있도록 하는 확률론에 기초한 공간 효율이 좋은 기술
		- 집합에 속한 원소를 속하지 않았다고 말하는 일(False Negative)은 절대 없다.
		- 반대로 속하지 않은 원소를 가끔 속해있다(False Positive)고 말할 때가 있다.
		- 블룸 필터와 RDBMS 를 섞어서 쓰는건 어떨까?

### base-62 변환

- 62진법(0~9, a~z, A~Z)으로 원래 URL 을 변환한다.
	- ID 생성기를 이용하여 원래 URL 에서 ID 를 얻어낸다.
	- 이 ID 를 62진수로 변환하여 단축 URL 을 얻는다.

| 해시 후 충돌 해소 전략 | base-62 변환 |
| ---- | ---- |
| 단축 URL 의 길이가 고정됨 | 단축 URL 의 길이가 가변적. ID 값이 커지면 같이 길어짐 |
| 유일성이 보장되는 ID 생성기가 필요치 않음 | 유일성 보장 ID 생성기가 필요 |
| 충돌이 가능해서 해소 전략이 필요 | ID의 유일성이 보장된 후에야 적용 가능한 전략이라 충돌은 아예 불가능 |
| ID 로부터 단축 URL 을 계산하는 방식이 아니라서 다음에 쓸 수 있는 URL 을 알아내는 것이 불가능 | ID가 1씩 증가하는 값이라고 가정하면 다음에 쓸 수 있는 단축 URL 이 무엇인지 쉽게 알아낼 수 있어서 보안상 문제가 될 소지가 있음 |







